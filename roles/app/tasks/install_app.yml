- name: Create temporary directory to get app
  tempfile:
    state: directory
    suffix: app
  register: r_tempfile
  connection: local
  run_once: yes
  become: no

- name: Git clone the website
  git:
    repo: "{{ app }}"
    version: "{{ ver }}"
    dest: "{{ r_tempfile.path }}"
  connection: local
  run_once: yes
  become: no

# - name: Debug list result of git checkout
#   command: "ls {{ r_tempfile.path }}"
#   register: dir_out
#   delegate_to: localhost

# - name: Debug display checkout content
#   debug: var={{item}}
#   with_items: dir_out.stdout_lines
#   delegate_to: localhost

- name: Copy conf to nodes 
  copy:
    src: "{{ r_tempfile.path }}/config/hello.conf" 
    dest: /etc/nginx/conf.d/default.conf
  become: yes
  # notify: restart_nginx

- name: Copy app to nodes 
  copy:
    src: "{{ r_tempfile.path }}/app/index.html" 
    dest: /usr/share/nginx/html/index.html 
  become: yes
